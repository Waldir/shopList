!function main($){"use strict";var version="1.0.14",v="?v=1.0.14",jsonId,jsonUrl="https://api.myjson.com/bins/",$theList1=$("#checkedList"),$theList2=$("#uncheckedList"),$theList3=$("#tagsUList"),$theList4=$("#tagsCList"),$contNewItem=$("#contNewItem"),$hideOnScroll=$(".hideOnScroll"),$tagCheckedHeader=$("#tagCheckedHeader"),$tagUncheckedHeader=$("#tagUncheckedHeader"),$uncheckedHeader=$("#uncheckedHeader"),$checkedHeader=$("#checkedHeader"),$inputNew=$("#newItem"),$inputShareId=$("#inputShareId"),jsonObj={},bodyEl=document.body,tagCookie=null,cache={};function getQueryStr(){var str=window.location.search;return!!str&&str.replace("?","")}function randId(){return"_"+Math.random().toString(36).substr(2,9)}function strToArr(str,div){var divider=div||" ";return str?str.split(divider):[]}function hasATag(_tag,_tagStr){var tag=_tag||"",tagStr;return!!tag&&strToArr((_tagStr||"").toLowerCase()).indexOf(tag.toLowerCase())>-1}function removeEmojis(str){return str.replace(/([\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g,"")}function createNewEl(checked,id,name){var html=[],sortName=removeEmojis(name).trim(),ck=checked?"checked":"unchecked",$title=$("<span>",{id:"itemName-"+id}).text(name),$del=$.createNewBtn("delete","deleteItem").attr({"data-index":id}),$tag=$.createNewBtn("tag","tag").attr({"data-index":id}),$edit=$.createNewBtn("pencil","editItem").attr({"data-index":id}),$arrow=$.createNewBtn("angle","arrow").attr({"data-index":id}),$check=$.createNewBtn(ck,"checkItem").attr({"data-index":id,"data-check":checked}),$col1=$("<div>",{class:"col-6 col-md-8 d-flex align-items-center"}),$col2=$("<div>",{class:"col-6 col-md-4 text-align-right right-menu"});return html.push($col1.append($check)),html.push($col1.append($title)),html.push($col2.append($arrow)),html.push($col2.append($tag)),html.push($col2.append($edit)),html.push($col2.append($del)),$("<div/>",{id:id,class:"row row-bar position-relative m-1","data-sort":sortName}).html(html)}function loadList(){$.get(jsonUrl+jsonId,function fn(data){jsonObj=data;var unchecked=[],checked=[],tagUnchecked=[],tagChecked=[],tCCount=0,tUCount=0,uCount=0,cCount=0,tTotal=0,uTotal=0,msg,html=[];if($theList1.empty(),$theList2.empty(),$theList3.empty(),$theList4.empty(),$.each(data,function fn(k,v){var div=createNewEl(v.checked,k,v.name),hasTag=hasATag(tagCookie,v.tags);hasTag&&v.checked&&(tagChecked.push(div),tCCount+=1,tTotal+=1),hasTag&&!v.checked&&(tagUnchecked.push(div),tUCount+=1,tTotal+=1),!hasTag&&v.checked&&(checked.push(div),cCount+=1,uTotal+=1),hasTag||v.checked||(unchecked.push(div),uCount+=1,uTotal+=1)}),unchecked.length>0?(msg="Unchecked: "+uCount+"/"+uTotal,$theList1.append(unchecked).sortDivs(),$uncheckedHeader.slideDown("fast").html(msg)):$uncheckedHeader.slideUp("fast"),checked.length>0?(msg=cCount===uTotal?"All done!":"Checked: "+cCount+"/"+uTotal,$theList2.append(checked).sortDivs(),$checkedHeader.slideDown("fast").html(msg)):$checkedHeader.slideUp("fast"),tagUnchecked.length>0){msg=tagCookie+": "+tUCount+"/"+tTotal;var $minusBtn1=$.createNewBtn("minus","delTagCookie");html.push($("<div>",{class:"col-6 d-flex align-items-center pl-3"}).html(msg)),html.push($("<div>",{class:"col-6 text-align-right"}).html($minusBtn1)),$theList3.append(tagUnchecked).sortDivs(),$tagUncheckedHeader.slideDown("fast").html(html)}else $tagUncheckedHeader.slideUp("fast");if(tagChecked.length>0){html=[],msg=tCCount===tTotal?"All done with "+tagCookie:tagCookie+": "+tCCount+"/"+tTotal;var $minusBtn2=$.createNewBtn("minus","delTagCookie");html.push($("<div>",{class:"col-6 d-flex align-items-center pl-3"}).html(msg)),html.push($("<div>",{class:"col-6 text-align-right"}).html($minusBtn2)),$theList4.append(tagChecked).sortDivs(),$tagCheckedHeader.slideDown("fast").html(html)}else $tagCheckedHeader.slideUp("fast")})}function triggerRefresh(){$("#reloadBtn img").addClass("rotated"),setTimeout(function x(){$("#reloadBtn img").removeClass("rotated")},600),loadList()}function updateJson(){$.ajax({url:jsonUrl+jsonId,type:"PUT",data:JSON.stringify(jsonObj),contentType:"application/json; charset=utf-8",dataType:"json",success:triggerRefresh})}function addItem(){var newItem=$inputNew.val(),id=randId();if(!newItem.trim())return!1;jsonObj[id]={name:newItem,checked:!1};var $el=createNewEl(!1,id,newItem).css("display","none");return $theList1.append($el).sortDivs(),$el.slideToggle("fast").coin("coin","new item created"),$inputNew.val(""),$contNewItem.slideUp("fast"),updateJson(),!1}function removeTagCell(ignore){var not=ignore||"";$(".tagCell").children().hide("fast"),$(".tagCell").slideToggle("slow",function x(){$(this).not(not).remove()})}function hideBottomMenu(){window.onscroll=function hideAddNew(){$.each($hideOnScroll,function x(k,v){$(v).is(":visible")&&!$(v).children("input").is(":focus")&&$(v).slideUp("fast")})}}function createNewList(){var id=randId();jsonObj[id]={name:"Bananas üçå",checked:!1,tags:"fruit costco"},$.ajax({url:"https://api.myjson.com/bins",type:"POST",data:JSON.stringify(jsonObj),contentType:"application/json; charset=utf-8",dataType:"json",success:function(data){window.location.href="?"+data.uri.match(/([^\/]*)\/*$/)[1]}})}function initList(){var cookieJsonId=$.getCookie("listId"),getJsonId=getQueryStr();return getJsonId?(jsonId=getJsonId,$.setCookie("listId",getJsonId),!0):!!cookieJsonId&&(jsonId=cookieJsonId,!0)}function forceCache(bool){return!!bool&&($("img, link, script").each(function x(){var src=$(this).attr("src"),href=$(this).attr("href"),tagName=$(this).prop("tagName");"LINK"===tagName&&$(this).attr("href",href+v),"IMG"!==tagName&&"SCRIPT"!==tagName||$(this).attr("src",src+v)}),!0)}$.extend({createNewBtn:function createNewBtn(src,classes){var $img=$("<img>",{src:"images/"+src+".svg"+v});return $("<div>",{class:"btn d-inline-block p-2 "+classes}).html($img)}}),$inputNew.keypress(function fn(e){13===e.which&&addItem()}).autocomplete({source:function source(request,response){var term=request.term;term in cache?response(cache[term]):$.getJSON("inc/foods.json",request,function x(data){var autoComplete=[];for(let i=0;i<data.length;i++){var name=data[i].name.toUpperCase(),thisTerm=term.toUpperCase(),match;name.match(thisTerm)&&autoComplete.push(data[i].emoji+" "+data[i].name)}cache[term]=autoComplete,response(autoComplete)})},minLength:2,position:{my:"left bottom",at:"left top",collision:"flip"}}),$("#reloadBtn").on("click",triggerRefresh),$("#shareList").on("click",function x(){$inputShareId.val("http://waldirb.com/sl/?"+jsonId),$inputShareId.copyToClip(),$(this).coin("coin","Clipboard!")}),$(".toggleOn").on("click",function x(){var data=$(this).data("index");$(data).slideToggle("fast").add(data+" input").focus()}),$(bodyEl).on("keypress","#inputTags",function fn(e){if(13===e.which){var tags=$("#inputTags").val(),id=$("#inputTagId").val();jsonObj[id]={name:jsonObj[id].name,checked:jsonObj[id].checked,tags:tags},$(this).coin("coin","tag updated"),updateJson()}}).on("click",".delTagCookie",function fn(){$.eraseCookie("tag"),tagCookie=null,$(this).coin("coin","tag reset"),triggerRefresh()}).on("keypress",".inputEditName",function fn(e){if(13===e.which){var val=$(this).val(),id=$(this).data("index");jsonObj[id]={name:val,checked:jsonObj[id].checked,tags:jsonObj[id].tags},$(this).coin("coin",val+" updated"),updateJson()}}).on("click",".editItem",function fn(){var id=$(this).data("index"),isOn=$(this).hasClass("on"),$itemEl=$("#itemName-"+id),nameVal=$itemEl.text(),newInputId="editInput-"+id,$newInput=$("<input>",{type:"text",id:newInputId,class:"inputEditName","data-index":id}).css("display","none").val(nameVal);$(this).toggleClass("on"),isOn?($itemEl.show(),$("#"+newInputId).remove()):($itemEl.hide().after($newInput),$newInput.slideToggle("fast").focus())}).on("click",".arrow",function fn(){var $arrow=$(this),$arrowParent=$(this).parent();$(".right-menu, .arrow").not($arrowParent).not($arrow).removeClass("on"),$arrow.toggleClass("on").parent().toggleClass("on"),$(".tag").removeClass("on"),removeTagCell()}).on("click",".deleteItem",function fn(){var id=$(this).attr("data-index"),$el=$("#"+id);return delete jsonObj[id],$el.slideToggle("fast"),updateJson(),!1}).on("click",".checkItem",function fn(){var $el=$(this),data=$el.data("check"),id=$el.data("index"),$img=$el.children("img"),$id=$("#"+id),ckb=data?"checked":"unchecked",ckc=data?"unchecked":"checked",jData=!data,hasTag=hasATag(tagCookie,jsonObj[id].tags),$list;return $list=jData?tagCookie&&hasTag?$theList4:$theList2:tagCookie&&hasTag?$theList3:$theList1,jsonObj[id]={name:jsonObj[id].name,checked:jData,tags:jsonObj[id].tags},$id.slideToggle("fast",function hide(){$id.appendTo($list),$list.sortDivs(),$el.data("check",ckc),$img.attr("src",$img.attr("src").replace(ckb,ckc)),$id.slideToggle("fast",updateJson)}),!1}).on("click",".tag",function fn(){var $this=$(this),isOn=$this.hasClass("on");if($this.toggleClass("on"),isOn)return removeTagCell(),!1;var id=$(this).parent().parent().attr("id"),$id=$("#"+id),tagId="tag-"+id,html=[],tagsArr=strToArr(jsonObj[id].tags);removeTagCell("#"+tagId),html.push($("<input/>",{type:"text",id:"inputTags",class:"mb-3",placeholder:"+ Add Space Separated Tags",val:jsonObj[id].tags}).css("width","100%")),html.push($("<input/>",{type:"hidden",id:"inputTagId",val:id})),html.push($("<br>"));for(let i=0;i<tagsArr.length;i++)html.push($("<span/>",{class:"mx-1 tagSelect"}).html(tagsArr[i]));var $div=$("<div/>",{id:tagId,class:"p-2 tagCell table"}).css("display","none").html(html);return $id.after($div),$("#"+tagId).fadeIn("fast"),!1}).on("click",".tagSelect",function fn(){var $this,tag=$(this).text();$.setCookie("tag",tag),tagCookie=tag,$(this).coin("coin",tag+" selected"),triggerRefresh()}),tagCookie=$.getCookie("tag"),initList()?loadList():createNewList(),hideBottomMenu(),forceCache(!1)}(jQuery);